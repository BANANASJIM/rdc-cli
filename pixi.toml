[workspace]
name = "rdc-cli"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-arm64", "osx-64"]

[dependencies]
python = "3.14.*"
uv = ">=0.5"

[target.osx-64.dependencies]
cmake = ">=3.26,<4"
ninja = ">=1.11,<2"
autoconf = ">=2.71,<3"
automake = ">=1.16,<2"
libtool = ">=2.4,<3"
pkg-config = ">=0.29,<1"
m4 = ">=1.4,<2"

[target.osx-arm64.dependencies]
cmake = ">=3.26,<4"
ninja = ">=1.11,<2"
autoconf = ">=2.71,<3"
automake = ">=1.16,<2"
libtool = ">=2.4,<3"
pkg-config = ">=0.29,<1"
m4 = ">=1.4,<2"

[activation.env]
RENDERDOC_PYTHON_PATH = ".local/renderdoc"
PYTHONPATH = "src"

[tasks]
sync = "uv sync --extra dev && git config core.hooksPath .githooks && bash scripts/ensure-renderdoc.sh"
setup-renderdoc = "python scripts/build_renderdoc.py .local/renderdoc --build-dir .local/renderdoc-build"
lint = "uv run ruff check src tests && uv run ruff format --check src tests"
typecheck = "uv run mypy src"
test = "uv run pytest tests/unit -v --cov=rdc --cov-report=term-missing --cov-fail-under=80"
test-gpu = "uv run pytest tests -v -m gpu --no-header"
test-all = "uv run pytest tests -v --cov=rdc --cov-report=term-missing"
check = "pixi run lint && pixi run typecheck && pixi run test"
gen-skill-ref = "bash -c 'uv run python scripts/gen-skill-ref.py > src/rdc/_skills/references/commands-quick-ref.md'"
check-skill-ref = "bash -c 'diff <(uv run python scripts/gen-skill-ref.py) src/rdc/_skills/references/commands-quick-ref.md'"
gen-replay = "bash -c 'uv run python scripts/gen-replay.py > docs-astro/src/data/replay.json'"
check-replay = "bash -c 'diff <(uv run python scripts/gen-replay.py) docs-astro/src/data/replay.json'"
gen-commands = "bash -c 'uv run python scripts/gen-commands.py > docs-astro/src/data/commands.json'"
check-commands = "bash -c 'diff <(uv run python scripts/gen-commands.py) docs-astro/src/data/commands.json'"
verify = "bash scripts/verify-package.sh"
e2e = "bash scripts/e2e-test.sh"
